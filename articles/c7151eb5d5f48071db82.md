---
title: "phpcs & phpcbf ã‚³ãƒãƒ³ãƒ‰ã«ã¤ã„ã¦ãƒ¡ãƒ¢"
emoji: "ğŸ¦”"
type: "tech"
topics: ["PHP", "phpcs", "phpcbf", "coding", "codingRule", "lint", "linter-phpcs", "Linter"]
published: true
---

# phpcs & phpcbf ã‚³ãƒãƒ³ãƒ‰ã«ã¤ã„ã¦ãƒ¡ãƒ¢

PHP ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã®æ•´ç†ã«ã‚ãŸã‚Šã€ phpcs ã¨ phpcbf ã«ã¤ã„ã¦è‰²ã€…è§¦ã£ã¦ã¿ãŸã®ã§ã€ãƒ¡ãƒ¢ã€‚

ã‚ãã¾ã§ã€ãƒ¡ãƒ¢ç¨‹åº¦ã€‚(**äºˆé˜²ç·š**)



- - -

### æ¦‚è¦

phpcs / phpcbf ã¨ã¯ä¸‹è¨˜ã‚’ç•¥ã—ãŸã‚³ãƒãƒ³ãƒ‰åã§ã‚ã‚Šã€ãã‚Œãã‚Œã®å½¹ç›®ã¯ä¸‹è¨˜ã®é€šã‚Šã€‚

* phpcs : PHP Code Sniffer
    * è¨­å®šã—ãŸãƒ«ãƒ¼ãƒ«ã«åŸºã¥ãã€æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ **åˆ¤å®š**

* phpcbf : PHP Code Beautifier and Fixer
    * è¨­å®šã—ãŸãƒ«ãƒ¼ãƒ«ã«åŸºã¥ãã€æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ **æ•´å½¢**

phpcs / phpcbf ã¨ã‚‚ã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ GitHub ä¸Šã® [squizlabs/PHP_CodeSniffer](https://github.com/squizlabs/PHP_CodeSniffer) ã§å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã€‚



- - -

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯ [README](https://github.com/squizlabs/PHP_CodeSniffer/blob/master/README.md) ã«æ›¸ã„ã¦ã‚ã‚‹é€šã‚Šã ãŒã€ç®¡ç†ã®ã—ã‚„ã™ã•ã‹ã‚‰ composer ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸæ–¹ãŒè‰¯ã•ãã†ã€‚

```
{
  "require-dev": {
    "squizlabs/php_codesniffer": "2.*"
  }
}
```

composer ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå ´åˆã¯ ```composer.json``` ã§ ```"config": { "bin-dir": "bin" }``` ç­‰ã®è¨­å®šã‚’ã—ãªã„é™ã‚Šã¯ ```./vendor/bin/phpcs``` / ```./vendor/bin/phpcbf``` ã§å®Ÿè¡Œå¯èƒ½ã¨ãªã‚‹ã€‚



- - -

### å®Ÿè¡Œæ–¹æ³•

ã€Œå®Ÿè¡Œæ–¹æ³•ã€ã«ã¤ã„ã¦ã¯ãƒ˜ãƒ«ãƒ— (```$ phpcs --help```) ã‚„åˆ¥ã®è¨˜äº‹ã‚’å‚è€ƒã«ã€‚

ãŸã ã— 1 ç‚¹ã ã‘ã€ CLI å®Ÿè¡Œæ™‚ã®å¼•æ•°ã¯å¤§ä½“ãŒ ```ruleset.xml``` ã‚’ç”¨æ„ã—ã¦è¨˜è¿°ã™ã‚‹ã“ã¨ã§è³„ãˆã‚‹ç‚ºã€
```ruleset.xml``` ã‚’å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã€
```--standard``` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã™ã‚‹å½¢ã®å®Ÿè¡Œæ–¹æ³•ã§å¯¾å¿œã™ã‚‹ã“ã¨ã‚’ã‚ªã‚¹ã‚¹ãƒ¡ã™ã‚‹ã€‚

```
# åˆ¤å®š
$ phpcs   --standard=/path/to/MyStandard/ruleset.xml

# æ•´å½¢
$ phpcbf  --standard=/path/to/MyStandard/ruleset.xml
```

* **ã€pointã€‘**
	* ```ruleset.xml``` ã§ã€ã‹ãªã‚Šç´°ã‹ãªè¨­å®šãŒã§ãã‚‹ç‚ºã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã‚’æ–‡ç« ã§ç®¡ç†ã›ãšã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« (```ruleset.xml```) ã§ç®¡ç†ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã®å¤‰æ›´ãªã©ã‚’ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å½¢ã§ææ¡ˆã—ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å—ã‘ã€æ‰¿èªã•ã‚Œã€æ¡ç”¨ã•ã‚Œã‚‹ã€ã¨ã„ã†æµã‚Œã‚’ä½œã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

* ```ruleset.xml``` è¨­å®šæ–¹æ³•
    * å‚ç…§ : [squizlabs/PHP_CodeSniffer/wiki](https://github.com/squizlabs/PHP_CodeSniffer/wiki)
        * [Annotated ruleset.xml](https://github.com/squizlabs/PHP_CodeSniffer/wiki/Annotated-ruleset.xml)
        * [Advanced Usage](https://github.com/squizlabs/PHP_CodeSniffer/wiki/Advanced-Usage) ã‚‚åˆã‚ã›ã¦å‚ç…§



- - -

### å®Ÿè¡Œçµæœ

```--report=csv``` ã‚„ ```--report=xml``` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã™ã‚‹ã¨ã€ä¸‹è¨˜ã®æƒ…å ±ãŒå¾—ã‚‰ã‚Œã‚‹ã€‚

| key                   | description               |
|-----------------------|---------------------------|
| File / Line / Column  | è­¦å‘Šç™ºç”Ÿç®‡æ‰€              |
| Type                  | WARNING or ERROR          |
| Message               | è­¦å‘Šå†…å®¹                  |
| Source                | ãƒ«ãƒ¼ãƒ« **ã€å¾Œè¿°ã€‘**       |
| Severity              | é‡ç—‡åº¦                    |
| Fixable               | **phpcbf ã§ã®æ•´å½¢å¯å¦**   |



- - -

#### Source (ãƒ«ãƒ¼ãƒ«) ã«ã¤ã„ã¦

* Source ã¯åŸºæœ¬çš„ã« ```<STANDARD>.<CATEGORY>.<SNIFF>[.<CODE>]``` ã¨ã„ã†å…·åˆã« ```.``` åŒºåˆ‡ã‚Šã§ 4 ã¤ã®è¦ç´ ã‹ã‚‰æ§‹æˆã•ã‚Œã‚‹ã€‚

* ä¸€éƒ¨ã€ ```<STANDARD>.<CATEGORY>.<SNIFF>``` ã® 3 ã¤ã‹ã‚‰ãªã‚‹ãƒ¢ãƒã‚‚ã‚ã‚‹ã€‚
    * ä¾‹ : PEAR.ControlStructures.ControlSignature ãªã©
        * è­¦å‘Šç™ºç”Ÿæ™‚ã« ```<CODE>``` ã®æŒ‡å®šã‚’ã—ã¦ã„ãªã„ç‚ºï¼Ÿ

* åˆ¤å®šå‡¦ç†ã¯ ```/path/to/<STANDARD>/Sniffs/<CATEGORY>/<SNIFF>Sniff.php``` ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§å‡¦ç†ã•ã‚Œã€å†…å®¹ã«ä¾ã£ã¦ ```<CODE>``` æŒ‡å®šã§è­¦å‘Šã•ã‚Œã‚‹ã€‚
    * ä¾‹ : ```Generic.Files.LineLength``` ã®å ´åˆã€ [./vendor/squizlabs/php_codesniffer/CodeSniffer/Standards/**Generic**/Sniffs/**Files**/**LineLength**Sniff.php](https://github.com/squizlabs/PHP_CodeSniffer/blob/master/CodeSniffer/Standards/Generic/Sniffs/Files/LineLengthSniff.php) ã§å‡¦ç†ã•ã‚Œã‚‹ã€‚

* ä½™è«‡ : 1 è¡Œã®æ–‡å­—æ•°ã‚’åˆ¤å®šã—ã¦ã„ã‚‹ ```Generic.Files.LineLength``` ã®ã‚³ãƒ¼ãƒ‰è‡ªä½“ãŒé•åã—ã¦ã„ã‚‹ã€‚

```
$ phpcs --sniffs=Generic.Files.LineLength ./vendor/squizlabs/php_codesniffer/CodeSniffer/Standards/Generic/Sniffs/Files/LineLengthSniff.php

FILE: ...r/CodeSniffer/Standards/Generic/Sniffs/Files/LineLengthSniff.php
----------------------------------------------------------------------
FOUND 0 ERRORS AND 5 WARNINGS AFFECTING 5 LINES
----------------------------------------------------------------------
  12 | WARNING | Line exceeds 85 characters; contains 94 characters
  28 | WARNING | Line exceeds 85 characters; contains 94 characters
  99 | WARNING | Line exceeds 85 characters; contains 91 characters
 117 | WARNING | Line exceeds 85 characters; contains 88 characters
 138 | WARNING | Line exceeds 85 characters; contains 91 characters
----------------------------------------------------------------------

Time: 14ms; Memory: 3.25Mb
```

* ä¸‹è¨˜ã®ã‚ˆã†ã« ```ruleset.xml``` ã§ ```<STANDARD>.<CATEGORY>.<SNIFF>``` ã‚’æŒ‡å®šã—ã¦åˆ¤å®šå€¤ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½
    * (ãƒ¯ã‚¤ãƒ‰ç”»é¢ãŒå½“ãŸã‚Šå‰ã®æ™‚ä»£ã« default å€¤ã§ã¯çŸ­ã„ç‚ºã€å°‘ã—ã€æ‹¡å¼µ)
    * **ã€æ³¨æ„ã€‘** ```<STANDARD>.<CATEGORY>.<SNIFF>.<CODE>``` ã§ã¯ãªã ```<STANDARD>.<CATEGORY>.<SNIFF>``` ã‚’æŒ‡å®šã—ã¦è¨­å®š
        * è­¦å‘Šã§ã¯ ```<STANDARD>.<CATEGORY>.<SNIFF>.<CODE>``` ãŒå‡ºã‚‹ç‚ºã€ãƒãƒã‚‰ãªã„ã‚ˆã†ã«â€¦ã€‚

```
<?xml version="1.0"?>
<ruleset name="...">
  ...
  <rule ref="Generic.Files.LineLength">
    <properties>
      <!--
        lineLimit           : 1 è¡Œã®æ–‡å­—æ•°ãŒè¶…éã™ã‚‹ã¨ WARNING ãŒç™ºç”Ÿ
        absoluteLineLimit   : 1 è¡Œã®æ–‡å­—æ•°ãŒè¶…éã™ã‚‹ã¨ ERROR ãŒç™ºç”Ÿ
        -->
      <property name="lineLimit" value="160"/>
      <property name="absoluteLineLimit" value="200"/>
    </properties>
  </rule>
  ...
</ruleset>
```



- - -

#### Source (ãƒ«ãƒ¼ãƒ«) è‡ªä½œ

* ç¥çµŒè³ªãªäºº (è‡ªåˆ†ã‚‚ï¼Ÿ) ã«ã¯ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã‚‚å®Ÿè£…ãŒå¯èƒ½ãªã®ã§ã€ãŠè©¦ã—ã‚ã‚Œã€‚
    * å‚è€ƒ : [Manual :: A list of configuration options](http://pear.php.net/manual/en/package.php.php-codesniffer.coding-standard-tutorial.php)
