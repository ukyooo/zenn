---
title: "MySQL JSON ã‚«ãƒ©ãƒ å†…ã®é…åˆ—ã®ã«å«ã¾ã‚Œã‚‹é€£æƒ³é…åˆ—ã®è¦ç´ ã‚’æ¤œç´¢ã™ã‚‹æ–¹æ³•"
emoji: "ğŸ’¬"
type: "tech"
topics: ["JSON", "MySQL", "SQL"]
published: true
---
[MySQL JSON ã‚«ãƒ©ãƒ å†…ã®é…åˆ—ã«å«ã¾ã‚Œã‚‹è¦ç´ ã‚’æ¤œç´¢ã™ã‚‹æ–¹æ³•](https://zenn.dev/ukyooo/articles/b60fd33a0feec6) ã®ç¶šãã€‚



----

ä¾‹ãˆã°ã€ä¸‹è¨˜ã®ã‚ˆã†ãª schema ã® table ãŒã‚ã£ãŸã¨ã—ã¦ã€

```sql
CREATE TABLE IF NOT EXISTS `user` (
    `id`    BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
    `data`  JSON,
    PRIMARY KEY (`id`)
) ;
```

----

ãã“ã«ä¸‹è¨˜ã®ã‚ˆã†ã« `skill` ã¨ã„ã†é…åˆ—ã«é€£æƒ³é…åˆ—ã®è¦ç´ ã‚’ INSERT ã—ã¦ã€

```sql
INSERT INTO user (data) VALUES
  ('{"skill": [{"tag": "Python", "has_experience": true},   {"tag": "JavaScript", "has_experience": true},  {"tag": "Java", "has_experience": true}   ]}'),
  ('{"skill": [{"tag": "Python", "has_experience": false},  {"tag": "JavaScript", "has_experience": true},  {"tag": "Java", "has_experience": true}   ]}'),
  ('{"skill": [{"tag": "Python", "has_experience": true},   {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": true}   ]}'),
  ('{"skill": [{"tag": "Python", "has_experience": true},   {"tag": "JavaScript", "has_experience": true},  {"tag": "Java", "has_experience": false}  ]}'),
  ('{"skill": [{"tag": "Python", "has_experience": true},   {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": false}  ]}'),
  ('{"skill": [{"tag": "Python", "has_experience": false},  {"tag": "JavaScript", "has_experience": true},  {"tag": "Java", "has_experience": false}  ]}'),
  ('{"skill": [{"tag": "Python", "has_experience": false},  {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": true}   ]}'),
  ('{"skill": [{"tag": "Python", "has_experience": false},  {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": false}  ]}');
```

----

ä¸­èº«ãŒä¸‹è¨˜ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹å ´åˆã€

```sql
SELECT * FROM user ;

+----+---------------------------------------------------------------------------------------------------------------------------------------------------+
| id | data                                                                                                                                              |
+----+---------------------------------------------------------------------------------------------------------------------------------------------------+
|  1 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": true}]}    |
|  2 | {"skill": [{"tag": "Python", "has_experience": false}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": true}]}   |
|  3 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": true}]}   |
|  4 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": false}]}   |
|  5 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": false}]}  |
|  6 | {"skill": [{"tag": "Python", "has_experience": false}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": false}]}  |
|  7 | {"skill": [{"tag": "Python", "has_experience": false}, {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": true}]}  |
|  8 | {"skill": [{"tag": "Python", "has_experience": false}, {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": false}]} |
+----+---------------------------------------------------------------------------------------------------------------------------------------------------+
```

----

`user` ã® `skill` ã« `tag="Python", has_experience=true`ã€€ãŒã‚ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã—ãŸã„å ´åˆã€ä¸‹è¨˜ã®ã‚ˆã†ã« `JSON_CONTAINS()` ã‚’ä½¿ç”¨ã—ã¦æŠ½å‡ºã§ãã‚‹ã€‚

```sql
SELECT * FROM user WHERE JSON_CONTAINS(data, '{"tag": "Python", "has_experience": true}', '$.skill') ;

+----+--------------------------------------------------------------------------------------------------------------------------------------------------+
| id | data                                                                                                                                             |
+----+--------------------------------------------------------------------------------------------------------------------------------------------------+
|  1 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": true}]}   |
|  3 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": true}]}  |
|  4 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": false}]}  |
|  5 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": false}]} |
+----+--------------------------------------------------------------------------------------------------------------------------------------------------+
```

----

é…åˆ—ã®å½¢ã§æŒ‡å®šã—ã¦ã‚‚åŒã˜çµæœã¨ãªã‚‹ã€‚

```sql
SELECT * FROM user WHERE JSON_CONTAINS(data, '[{"tag": "Python", "has_experience": true}]', '$.skill') ;

+----+--------------------------------------------------------------------------------------------------------------------------------------------------+
| id | data                                                                                                                                             |
+----+--------------------------------------------------------------------------------------------------------------------------------------------------+
|  1 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": true}]}   |
|  3 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": true}]}  |
|  4 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": false}]}  |
|  5 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": false}]} |
+----+--------------------------------------------------------------------------------------------------------------------------------------------------+
```

----

ã¾ãŸã€æŒ‡å®šã—ãŸé…åˆ—ã®è¦ç´ ã‚’è¤‡æ•°ã«ã—ãŸå ´åˆã€

```sql
SELECT * FROM user WHERE JSON_CONTAINS(data, '[{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": true}]', '$.skill') ;

+----+-------------------------------------------------------------------------------------------------------------------------------------------------+
| id | data                                                                                                                                            |
+----+-------------------------------------------------------------------------------------------------------------------------------------------------+
|  1 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": true}]}  |
|  4 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": false}]} |
+----+-------------------------------------------------------------------------------------------------------------------------------------------------+
```

----

```sql
SELECT * FROM user WHERE JSON_CONTAINS(data, '[{"tag": "Python", "has_experience": true}, {"tag": "Java", "has_experience": true}]', '$.skill') ;

+----+-------------------------------------------------------------------------------------------------------------------------------------------------+
| id | data                                                                                                                                            |
+----+-------------------------------------------------------------------------------------------------------------------------------------------------+
|  1 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": true}]}  |
|  3 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": true}]} |
+----+-------------------------------------------------------------------------------------------------------------------------------------------------+
```

`AND` æ¤œç´¢ã¨ãªã‚‹ã€‚

----

ã‚‚ã¡ã‚ã‚“ã€ä¸‹è¨˜ã®ã‚ˆã†ã« `OR` æ¤œç´¢ã‚‚ã§ãã‚‹ã€‚

```sql
SELECT * FROM user
  WHERE JSON_CONTAINS(data, '{"tag": "Python",      "has_experience": true}', '$.skill')
    OR  JSON_CONTAINS(data, '{"tag": "JavaScript",  "has_experience": true}', '$.skill') ;

+----+--------------------------------------------------------------------------------------------------------------------------------------------------+
| id | data                                                                                                                                             |
+----+--------------------------------------------------------------------------------------------------------------------------------------------------+
|  1 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": true}]}   |
|  2 | {"skill": [{"tag": "Python", "has_experience": false}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": true}]}  |
|  3 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": true}]}  |
|  4 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": false}]}  |
|  5 | {"skill": [{"tag": "Python", "has_experience": true}, {"tag": "JavaScript", "has_experience": false}, {"tag": "Java", "has_experience": false}]} |
|  6 | {"skill": [{"tag": "Python", "has_experience": false}, {"tag": "JavaScript", "has_experience": true}, {"tag": "Java", "has_experience": false}]} |
+----+--------------------------------------------------------------------------------------------------------------------------------------------------+
```
